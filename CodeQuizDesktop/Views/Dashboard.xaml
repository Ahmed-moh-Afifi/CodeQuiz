<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CodeQuizDesktop.Views.Dashboard"
             x:Name="This">
    <Grid>
        <ScrollView >
            <VerticalStackLayout Padding="30,20" Spacing="24">
                <VerticalStackLayout Spacing="4">
                    <Label Text="Dashboard" FontSize="28" FontFamily="InterExtraBold" TextColor="White"/>
                    <Label Text="{Binding CurrentUser.UserName, StringFormat='Welcome back, {0}!'}"
                           FontSize="14" FontFamily="InterRegular" TextColor="#6B7280"/>
                </VerticalStackLayout>

                <Grid ColumnDefinitions="*,*" ColumnSpacing="24">
                    <!-- Joined Exams Section -->
                    <Border Grid.Column="0" BackgroundColor="#2e2e2e" Padding="24" StrokeThickness="0" StrokeShape="RoundRectangle 16">
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.08" Radius="20" Offset="0,4"/>
                        </Border.Shadow>

                        <VerticalStackLayout Spacing="20">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" Text="Joined Exams" FontSize="20" FontFamily="InterExtraBold" TextColor="White" VerticalOptions="Center"/>
                                <Label Grid.Column="1" Text="View All →" FontSize="14" FontFamily="InterRegular" TextColor="#888888" VerticalOptions="Center"/>
                            </Grid>

                            <CollectionView ItemsSource="{Binding JoinedAttempts}" SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Border BackgroundColor="#1e1e1e" Padding="16" StrokeThickness="0" Stroke="#2f2f2f" StrokeShape="RoundRectangle 12" Margin="0,0,0,12">
                                            <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
                                                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                                    <Label Grid.Column="0" Text="{Binding Quiz.Title}" FontSize="16" FontFamily="InterRegular" FontAttributes="Bold" TextColor="White"/>
                                                    <Border Grid.Column="1" BackgroundColor="#888888" Padding="8,4" StrokeThickness="0" StrokeShape="RoundRectangle 6">
                                                        <Label Text="{Binding Status}" FontSize="10" FontFamily="InterExtraBold" TextColor="White"/>
                                                    </Border>
                                                </Grid>

                                                <VerticalStackLayout Grid.Row="1" Spacing="6">
                                                    <Label Text="{Binding Quiz.Examiner.FullName, StringFormat='Created by: {0}'}" FontSize="13" TextColor="#888888"/>
                                                    <Label Text="{Binding Quiz.Duration}" FontSize="13" TextColor="#888888"/>
                                                </VerticalStackLayout>

                                                <HorizontalStackLayout Grid.Row="2"
                       Spacing="6"
                       IsVisible="{Binding IsRunning}">
                                                    <Label Text="Ends in:"
           FontSize="13"
           TextColor="#888888"/>
                                                    <Label Text="{Binding MaxEndTime, StringFormat='{0:t}'}"
           FontSize="13"
           FontFamily="InterExtraBold"
           TextColor="#EF4444"/>
                                                </HorizontalStackLayout>


                                                <HorizontalStackLayout Grid.Row="2" Spacing="8" IsVisible="{Binding IsCompleted}">
                                                    <Label Text="Score:" FontSize="13" TextColor="#888888"/>
                                                    <Label Text="{Binding GradePercentage, StringFormat='{0:0}%'}" FontSize="13" FontFamily="InterExtraBold" TextColor="#10B981"/>
                                                </HorizontalStackLayout>

                                                <Grid Grid.Row="3">
                                                    <Button Text="Continue ▶" BackgroundColor="#591c21" TextColor="White" FontFamily="InterRegular" FontSize="14" Padding="0,12" Command="{Binding Source={x:Reference This}, Path=BindingContext.ContinueAttemptCommand}" CommandParameter="{Binding}" IsVisible="{Binding IsRunning}" />
                                                    <Button Text="View Results" BackgroundColor="#888888" TextColor="White" FontFamily="InterRegular" FontSize="14" Padding="0,12" Command="{Binding Source={x:Reference This}, Path=BindingContext.ViewResultsCommand}" CommandParameter="{Binding}" IsVisible="{Binding IsCompleted}"/>
                                                </Grid>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Created Exams Section -->
                    <Border Grid.Column="1" BackgroundColor="#2e2e2e" Padding="24" StrokeThickness="0" StrokeShape="RoundRectangle 16">
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.08" Radius="20" Offset="0,4"/>
                        </Border.Shadow>

                        <VerticalStackLayout Spacing="20">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" Text="Created Exams" FontSize="20" FontFamily="InterExtraBold" TextColor="White" VerticalOptions="Center"/>
                                <Label Grid.Column="1" Text="Manage All →" FontSize="14" FontFamily="InterRegular" TextColor="#888888" VerticalOptions="Center"/>
                            </Grid>

                            <!-- Upcoming Quizzes -->
                            <CollectionView ItemsSource="{Binding UpcomingQuizzes}" SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Border BackgroundColor="#1e1e1e" Padding="16" StrokeThickness="0" Stroke="#2f2f2f" StrokeShape="RoundRectangle 12" Margin="0,0,0,12">
                                            <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
                                                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                                    <Label Grid.Column="0" Text="{Binding Title}" FontSize="16" FontFamily="InterRegular" FontAttributes="Bold" TextColor="White"/>
                                                    <Border Grid.Column="1" BackgroundColor="#888888" Padding="8,4" StrokeThickness="0" StrokeShape="RoundRectangle 6">
                                                        <Label Text="UPCOMING" FontSize="10" FontFamily="InterExtraBold" TextColor="White"/>
                                                    </Border>
                                                </Grid>

                                                <Label Grid.Row="1" Text="{Binding DurationString}" FontSize="13" TextColor="#888888"/>

                                                <Border Grid.Row="2" BackgroundColor="#2e2e2e" Padding="12,8" StrokeThickness="0" StrokeShape="RoundRectangle 8">
                                                    <HorizontalStackLayout Spacing="8">
                                                        <Label Text="Code:" FontSize="13" TextColor="#6B7280"/>
                                                        <Label Text="{Binding Code}" FontSize="13" FontFamily="SFMonoRegular" FontAttributes="Bold" TextColor="#2563EB"/>
                                                    </HorizontalStackLayout>
                                                </Border>

                                                <Button Grid.Row="3" Text="View Details" BackgroundColor="#888888" TextColor="White" FontFamily="InterRegular" FontSize="14" Padding="0,12" Command="{Binding Source={x:Reference This}, Path=BindingContext.ViewCreatedQuizCommand}" CommandParameter="{Binding}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                            <!-- Ended Quizzes -->
                            <CollectionView ItemsSource="{Binding EndedQuizzes}" SelectionMode="None">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Border BackgroundColor="#1e1e1e" Padding="16" StrokeThickness="0" Stroke="#E5E7EB" StrokeShape="RoundRectangle 12" Margin="0,0,0,12">
                                            <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="12">
                                                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                                    <Label Grid.Column="0" Text="{Binding Title}" FontSize="16" FontFamily="InterRegular" FontAttributes="Bold" TextColor="White"/>
                                                    <Border Grid.Column="1" BackgroundColor="#888888" Padding="8,4" StrokeThickness="0" StrokeShape="RoundRectangle 6">
                                                        <Label Text="ENDED" FontSize="10" FontFamily="InterExtraBold" TextColor="White"/>
                                                    </Border>
                                                </Grid>

                                                <Label Grid.Row="1" Text="{Binding SubmittedAttemptsCount, StringFormat='{}{0} Submitted'}" FontSize="13" TextColor="#888888"/>

                                                <HorizontalStackLayout Grid.Row="2" Spacing="8">
                                                    <Label Text="Avg Score:" FontSize="13" TextColor="#888888"/>
                                                    <Label Text="{Binding AverageAttemptScore, StringFormat='{0:0}%'}" FontSize="13" FontFamily="InterExtraBold" TextColor="#10B981"/>
                                                </HorizontalStackLayout>

                                                <Grid Grid.Row="3" ColumnDefinitions="*,*" ColumnSpacing="8">
                                                    <Button Text="View" BackgroundColor="#888888" TextColor="White" FontFamily="InterRegular" FontSize="14" Padding="0,12" Command="{Binding Source={x:Reference This}, Path=BindingContext.ViewCreatedQuizCommand}" CommandParameter="{Binding}"/>
                                                    <Button Grid.Column="1" Text="Delete" BackgroundColor="#888888" TextColor="White" FontFamily="InterRegular" FontSize="14" Padding="0,12" Command="{Binding Source={x:Reference This}, Path=BindingContext.DeleteCreatedQuizCommand}" CommandParameter="{Binding}"/>
                                                </Grid>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Border>
                </Grid>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentView>
